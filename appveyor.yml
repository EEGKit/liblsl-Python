version: 1.13.0.{build}
pull_requests:
  do_not_increment_build_number: true
shallow_clone: true
stack: python 3
environment:
  GITHUB_URL: https://github.com/sccn/liblsl/releases/download
  LIBLSL_TAG: 1.13.0-b12
  LIBLSL_VERSION: 1.13.0
  TWINE_USERNAME: cboulay
# Note: TWINE_PASSWORD is set in Appveyor web settings

#https://www.appveyor.com/docs/getting-started-with-appveyor-for-linux/#running-windows-and-linux-builds-side-by-side
build_script:
- cmd: appveyor DownloadFile %GITHUB_URL%/%LIBLSL_TAG%/liblsl-%LIBLSL_VERSION%-Win64.7z -FileName win_amd64.7z
- cmd: appveyor DownloadFile %GITHUB_URL%/%LIBLSL_TAG%/liblsl-%LIBLSL_VERSION%-Win32.7z -FileName win32.7z
- cmd: mkdir manylinux2010_x86_64
- cmd: appveyor DownloadFile %GITHUB_URL%/%LIBLSL_TAG%/liblsl-%LIBLSL_VERSION%-manylinux2010_x64.so -FileName manylinux2010_x86_64/liblsl.so
- cmd: python -m pip install --upgrade setuptools wheel
- cmd: 7z e win_amd64.7z bin/liblsl*.dll -Owin_amd64
- cmd: 7z e win32.7z bin/liblsl*.dll -Owin32
- pwsh: >-
        Foreach($platform in 'win_amd64', 'win32', 'manylinux2010_x86_64') {
                Copy-Item $platform -Destination pylsl/lib -Recurse
                python setup.py bdist_wheel -p $platform
                Remove-Item -LiteralPath pylsl/lib -Force -Recurse
        }
- ps: >-
      if ($env:APPVEYOR_REPO_TAG -eq "true") {
        python -m pip install twine
        python -m twine upload dist/*.whl
      } Else {
        echo "Not uploading to pypi; APPVEYOR_REPO_TAG : $env:APPVEYOR_REPO_TAG"
      }
artifacts:
- path: "dist/*.whl"
  name: Wheels
